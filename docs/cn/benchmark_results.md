# wfrest 文件缓存基准测试结果

## 概述

wfrest 文件缓存基准测试比较了普通静态文件服务与缓存静态文件服务的性能。该基准测试展示了使用 wfrest 文件缓存系统可以实现的显著性能提升。

## 基准测试设置

该基准测试测试了以下内容：

- **普通静态文件服务**：每个请求都直接从磁盘读取文件
- **缓存静态文件服务**：文件在首次访问后存储在内存中

测试使用 `wrk` HTTP 基准测试工具来测量：
- **每秒请求数（RPS）**：服务器每秒可以处理的请求数
- **延迟**：响应时间（毫秒）

## 基准测试结果

根据显示的结果，我们可以观察到：

| 文件 | 大小 | 普通请求数/秒 | 普通延迟(ms) | 缓存请求数/秒 | 缓存延迟(ms) | RPS 提升 | 延迟改进 |
|------|------|--------------|------------|--------------|------------|---------|---------|
| test_1024.dat | 1.00 KB | 135614.00 | 0.00 | 270770.00 | 0.00 | 2.00x | 1.00x |
| test_10240.dat | 10.00 KB | 123302.00 | 0.00 | 249637.00 | 0.00 | 2.02x | 1.00x |
| test_51200.dat | 50.00 KB | 62879.20 | 0.00 | 186190.00 | 0.00 | 2.13x | 1.00x |
| test_102400.dat | 100.00 KB | 86171.30 | 0.00 | 129868.00 | 0.00 | 1.51x | 1.00x |
| test_512000.dat | 500.00 KB | 11523.40 | 0.00 | 38390.80 | 0.00 | 3.33x | 1.00x |
| test_1048576.dat | 1.00 MB | 4615.52 | 0.00 | 17077.30 | 0.00 | 3.78x | 1.00x |

### 主要发现

1. **整体性能提升**：缓存静态文件服务在所有文件大小上都持续优于普通静态文件服务。

2. **RPS 改进**：
   - 小文件（1KB - 50KB）：2.00x - 2.13x 性能提升
   - 中等文件（100KB）：1.51x 性能提升
   - 大文件（500KB - 1MB）：3.33x - 3.78x 性能提升

3. **按文件大小的性能**：
   - 最大的性能提升在大型文件上（1MB 文件速度提升 3.78 倍）
   - 即使是小文件也看到显著的性能提升（1KB 文件提升 2.00 倍）

## 视觉比较

基准测试结果中的柱状图清晰地说明了普通和缓存文件服务之间的性能差异：

- 绿色条（缓存静态）始终高于粉色条（普通静态）
- 性能差异在较大的文件上尤为明显
- 随着文件大小增加，两种方法的每秒请求数都会下降（预期行为）

## 如何运行基准测试

可以使用包含的基准测试工具运行基准测试：

```bash
./30_cache_benchmark 8888 [测试持续时间（秒）] [并发数]
```

然后在网络浏览器中打开 http://localhost:8888/ 查看交互式基准测试界面。

您可以自定义：
- 测试持续时间（秒）
- 并发级别（并行连接数）

## 技术实现

基准测试：
1. 生成各种大小的测试文件（1KB - 1MB）
2. 使用两个路由 - 一个使用普通文件服务，一个使用缓存文件服务
3. 针对每个文件对两个路由运行 wrk 基准测试
4. 计算性能指标（RPS、延迟、加速）

## 结论

基准测试结果表明，使用 wfrest 的文件缓存系统为静态文件服务提供了显著的性能改进：

- 每秒请求数提高 2.0x - 3.8x 
- 在所有文件大小上都有一致的性能提升
- 对大文件有更大的改进

这使得缓存静态文件服务成为生产环境中频繁访问的静态资产的绝佳选择。

有关配置详情和实现，请参阅 [cached_static_files.md](../cached_static_files.md) 和 [static_file_optimization.md](../static_file_optimization.md) 文档。 